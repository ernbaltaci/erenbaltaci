---
// Import the global.css file here so that it is included on
// all pages through the use of the <BaseHead /> component.
import '../styles/global.css';
import { SITE_TITLE, SITE_DESCRIPTION } from '../config';

export interface Props {
  title: string;
  description?: string;
  image?: string;
  canonical?: string;
  type?: string;
  structuredData?: Record<string, any> | Record<string, any>[];
  noindex?: boolean;
  keywords?: string[];
}

const {
  title,
  description = SITE_DESCRIPTION,
  image = '/placeholder-social.jpg',
  canonical,
  type = 'website',
  structuredData,
  noindex = false,
  keywords = [],
} = Astro.props as Props;

const currentUrl = Astro.url ? Astro.url.toString() : '/';
const canonicalUrl = canonical ?? currentUrl;
const resolveAbsoluteUrl = (path: string) => {
  if (!path) return '';
  try {
    if (path.startsWith('http://') || path.startsWith('https://')) return path;
    if (Astro.url) return new URL(path, Astro.url).toString();
  } catch (err) {
    return path;
  }
  return path;
};

const imageUrl = resolveAbsoluteUrl(image);
const robotsContent = noindex ? 'noindex, nofollow' : 'index, follow';
const schemaPayload = Array.isArray(structuredData)
  ? structuredData
  : structuredData
  ? [structuredData]
  : [];
const defaultSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: SITE_TITLE,
  url: canonicalUrl,
  description,
};
const schemaToRender = [defaultSchema, ...schemaPayload];
---

<!-- Global Metadata -->
<meta charset='utf-8' />
<meta name='viewport' content='width=device-width,initial-scale=1' />
<link rel='icon' type='image/jpeg' href='/placeholder-social.jpg' />
<meta name='generator' content={Astro.generator} />
<meta name='theme-color' content='#0b0d10' />
<link rel='canonical' href={canonicalUrl} />

<!-- Primary Meta Tags -->
<title>{title}</title>
<meta name='title' content={title} />
<meta name='description' content={description} />
<meta name='robots' content={robotsContent} />
{keywords.length > 0 && <meta name='keywords' content={keywords.join(', ')} />}

<!-- Open Graph / Facebook -->
<meta property='og:type' content={type} />
<meta property='og:url' content={canonicalUrl} />
<meta property='og:title' content={title} />
<meta property='og:description' content={description} />
<meta property='og:image' content={imageUrl} />
<meta property='og:site_name' content={SITE_TITLE} />
<meta property='og:locale' content='en_US' />

<!-- Twitter -->
<meta property='twitter:card' content='summary_large_image' />
<meta property='twitter:url' content={canonicalUrl} />
<meta property='twitter:title' content={title} />
<meta property='twitter:description' content={description} />
<meta property='twitter:image' content={imageUrl} />
<meta property='twitter:site' content='@ernbaltaci' />

<!-- Structured Data -->
{
  schemaToRender.map((schema) => (
    <script type='application/ld+json'>{JSON.stringify(schema)}</script>
  ))
}

