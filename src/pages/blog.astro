---
import BaseHead from '../components/BaseHead.astro';
import ProfileCard from '../components/ProfileCard.astro';
import { SITE_TITLE } from '../config';

// Use Astro.glob() to fetch all posts, and then sort them by date.
type Post = {
  frontmatter: { publishDate: string; title: string };
  url: string;
};
const posts: Post[] = (
  (await Astro.glob('./blog/*.{md,mdx}')) as unknown as Post[]
).sort(
  (a: Post, b: Post) =>
    new Date(b.frontmatter.publishDate).valueOf() -
    new Date(a.frontmatter.publishDate).valueOf()
);
const blogDescription =
  'Field notes on API-first SaaS, automation workflows, and building solo.';
const blogUrl = Astro.url?.toString() ?? 'https://erenbaltaci.com/blog';
---

<!DOCTYPE html>
<html lang='en-us'>
  <head>
    <BaseHead
      title={`Blog • ${SITE_TITLE}`}
      description={blogDescription}
      keywords={[
        'API-first blog',
        'Astro blog',
        'SaaS architecture',
        'automation',
      ]}
      structuredData={[
        {
          '@context': 'https://schema.org',
          '@type': 'Blog',
          name: `${SITE_TITLE} Blog`,
          description: blogDescription,
          url: blogUrl,
          author: {
            '@type': 'Person',
            name: 'Eren Baltacı',
          },
        },
        {
          '@context': 'https://schema.org',
          '@type': 'ItemList',
          itemListElement: posts.map((post, index) => ({
            '@type': 'ListItem',
            position: index + 1,
            url: new URL(post.url, Astro.url).toString(),
            name: post.frontmatter.title,
          })),
        },
      ]}
    />
    <style>
      ul {
        list-style-type: none;
        padding: unset;
        margin: 0;
      }
      ul li {
        display: flex;
        gap: 12px;
      }
      ul li time {
        flex: 0 0 130px;
        font-style: italic;
        color: #888;
      }
      ul li a:visited {
        color: #60a5fa;
      }
      @media (max-width: 600px) {
        ul li {
          display: grid;
          grid-template-columns: 1fr;
        }
        ul li time {
          order: -1;
          flex: initial;
          color: #9ca3af;
        }
        /* On small screens, clamp long titles to one line */
        ul li a {
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
          display: block;
        }
      }
    </style>
  </head>
  <body>
    <main class='content-grid'>
      <aside>
        <ProfileCard
          name='Eren Baltacı'
          avatarSrc='/placeholder-social.jpg'
          occupation='Solopreneur'
          location='Turkiye'
          backHref='/'
          backLabel='Back to Home'
        />
      </aside>
      <content>
        <header class='page-hero'>
          <h1>API-first field notes</h1>
          <p>{blogDescription}</p>
        </header>
        <ul>
          {
            posts.map((post) => (
              <li>
                <time datetime={post.frontmatter.publishDate} class='no-wrap'>
                  {new Date(post.frontmatter.publishDate).toLocaleDateString(
                    'en-us',
                    {
                      year: 'numeric',
                      month: 'short',
                      day: 'numeric',
                    }
                  )}
                </time>
                <a href={post.url}>{post.frontmatter.title}</a>
              </li>
            ))
          }
        </ul>
      </content>
    </main>
  </body>
</html>

