---
import BaseHead from '../components/BaseHead.astro';
import ProfileCard from '../components/ProfileCard.astro';
import ShowcaseSection from '../components/ShowcaseSection.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../config';
import type {
  BlogPostListItem,
  ProjectFrontmatter,
  WorkFrontmatter,
  ShowcaseFrontmatter,
  ShowcaseContent,
} from '../types';
// Fetch latest posts for Logbook
const posts: BlogPostListItem[] = (
  (await Astro.glob('./blog/*.{md,mdx}')) as unknown as BlogPostListItem[]
)
  .sort(
    (a: BlogPostListItem, b: BlogPostListItem) =>
      new Date(b.frontmatter.publishDate).valueOf() -
      new Date(a.frontmatter.publishDate).valueOf()
  )
  .slice(0, 10);

const projects: ProjectFrontmatter[] = (
  await Astro.glob('../data/projects/*.md')
).map((mod: any) => mod.frontmatter as ProjectFrontmatter);

const work: WorkFrontmatter[] = (await Astro.glob('../data/work/*.md')).map(
  (mod: any) => mod.frontmatter as WorkFrontmatter
);

let showcaseModules: any[] = [];
try {
  showcaseModules = await Astro.glob('../data/showcase/*.md');
} catch (err) {
  console.warn('Unable to load showcase content', err);
  showcaseModules = [];
}

const showcase: ShowcaseContent[] = await Promise.all(
  showcaseModules.map(async (mod: any) => {
    const frontmatter = mod.frontmatter as ShowcaseFrontmatter;
    const fallbackSlug =
      mod?.file?.split('/')?.pop()?.replace('.md', '') ??
      frontmatter.title.toLowerCase().replace(/[^a-z0-9]+/g, '-');
    const bodyHtml = mod.compiledContent
      ? await mod.compiledContent()
      : undefined;
    return {
      ...frontmatter,
      slug: frontmatter.slug || fallbackSlug,
      bodyHtml,
    };
  })
);
---

<!DOCTYPE html>
<html lang='en-us'>
  <head>
    <BaseHead
      title={`${SITE_TITLE}`}
      description={SITE_DESCRIPTION}
      keywords={[
        'Eren Baltac覺',
        'API-first',
        'solopreneur',
        'SaaS',
        'automation',
      ]}
      structuredData={[
        {
          '@context': 'https://schema.org',
          '@type': 'Person',
          name: 'Eren Baltac覺',
          jobTitle: 'Solopreneur',
          url: Astro.url?.toString() ?? 'https://erenbaltaci.com',
          sameAs: [
            'mailto:ernbaltaci@gmail.com',
            'https://github.com/ernbaltaci',
            'https://www.linkedin.com/in/eren-baltaci/',
          ],
          worksFor: {
            '@type': 'Organization',
            name: 'Eren Baltac覺 Studio',
          },
        },
      ]}
    />
  </head>
  <body>
    <main class='container'>
      <aside>
        <ProfileCard
          name='Eren Baltac覺'
          avatarSrc='/placeholder-social.jpg'
          occupation='Solopreneur'
          location='Turkiye'
        >
          <nav style='font-size:14px'>
            <a href='mailto:ernbaltaci@gmail.com'>Email</a>
            |
            <a href='/blog'>Blog</a>
            |
            <a href='/showcases'>Showcases</a>
            |
            <a
              href='https://github.com/ernbaltaci'
              target='_blank'
              rel='noopener'>Github</a
            >
          </nav>
        </ProfileCard>
      </aside>

      <section>
        <h3 class='accent'>Work</h3>
        <div class='card'>
          <div
            class='work-grid stack-md'
            style='display:grid;grid-template-columns:120px 1fr;gap:12px;align-items:start'
          >
            <div class='muted'>Current</div>
            <ul style='margin:0;padding-left:18px;list-style:none'>
              {
                work
                  .filter((w) => !w.past)
                  .map((w) => (
                    <li style='margin:2px 0'>
                      {w.role} @
                      <a href={w.url} target='_blank' rel='noopener'>
                        {w.name}
                      </a>
                    </li>
                  ))
              }
            </ul>

            <div class='muted'>Past</div>
            <ul style='margin:0;padding-left:18px;list-style:none'>
              {
                work
                  .filter((w) => w.past)
                  .map((w) => (
                    <li style='margin:2px 0'>
                      {w.role} @
                      <a href={w.url} target='_blank' rel='noopener'>
                        {w.name}
                      </a>
                    </li>
                  ))
              }
            </ul>
          </div>
        </div>

        <h3 class='accent'>Projects</h3>
        <div class='card'>
          <div
            class='projects-grid stack-md'
            style='display:grid;grid-template-columns:120px 1fr;gap:8px;align-items:start'
          >
            <div class='muted'>Active</div>
            <div>
              {
                projects
                  .filter((project) => !project.isInactive)
                  .map((project) => (
                    <a href={project.url} target='_blank' rel='noopener'>
                      {project.name}
                    </a>
                  ))
              }
            </div>
            <div class='muted'>Inactive</div>
            <div>
              {
                projects
                  .filter((project) => project.isInactive)
                  .map((project) => (
                    <a
                      href={project.url || '#'}
                      target='_blank'
                      rel='noopener'
                      class={project.url ? '' : 'muted'}
                    >
                      {project.name}
                    </a>
                  ))
              }
            </div>
          </div>
        </div>

        <div class='section-title-row'>
          <h3 class='accent'>Blog</h3>
          <a class='section-view-all' href='/blog'>View all</a>
        </div>
        <div class='card'>
          <ul style='margin:0;padding-left:18px;list-style:none'>
            {
              posts.map((post) => (
                <li style='display:flex;gap:12px'>
                  <time
                    datetime={post.frontmatter.publishDate}
                    class='muted'
                    style='flex:0 0 130px'
                  >
                    {new Date(post.frontmatter.publishDate).toLocaleDateString(
                      'en-us',
                      { year: 'numeric', month: 'short', day: 'numeric' }
                    )}
                  </time>
                  <a href={post.url}>{post.frontmatter.title}</a>
                </li>
              ))
            }
          </ul>
        </div>

        <ShowcaseSection
          title='Showcases'
          items={showcase}
          limit={4}
          viewAllHref='/showcases'
        />
      </section>
    </main>
  </body>
</html>

