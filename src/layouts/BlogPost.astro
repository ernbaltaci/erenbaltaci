---
import BaseHead from '../components/BaseHead.astro';
import ProfileCard from '../components/ProfileCard.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../config';
import { Image } from '@astrojs/image/components';

export interface Props {
  content: {
    title: string;
    description: string;
    publishDate?: string;
    updatedDate?: string;
    heroImage?: string;
  };
}

const {
  content: { title, description, publishDate, updatedDate, heroImage },
} = Astro.props as Props;

// Match the `heroImage` frontmatter string to its correct
// Astro.glob() import of the file in the src/ directory.
const assets = await Astro.glob('../assets/**/*');
const heroImageAsset = assets.find((asset: any) => {
  if (!heroImage) {
    return false;
  }
  if (!asset.default?.src) {
    return false;
  }
  const index = asset.default.src.indexOf('/assets/');
  return asset.default.src.slice(index) === heroImage;
});

const pageUrl = Astro.url?.toString() ?? 'https://erenbaltaci.com/blog';
const ogImage =
  heroImageAsset?.default?.src || heroImage || '/placeholder-social.jpg';
const articleStructuredData = {
  '@context': 'https://schema.org',
  '@type': 'Article',
  headline: title,
  description: description || SITE_DESCRIPTION,
  datePublished: publishDate,
  dateModified: updatedDate || publishDate,
  url: pageUrl,
  image: ogImage,
  author: {
    '@type': 'Person',
    name: SITE_TITLE,
  },
  publisher: {
    '@type': 'Person',
    name: SITE_TITLE,
  },
};
---

<html>
  <head>
    <BaseHead
      title={`${title} • ${SITE_TITLE}`}
      description={description || SITE_DESCRIPTION}
      image={ogImage}
      type='article'
      canonical={pageUrl}
      structuredData={articleStructuredData}
      keywords={['blog', 'api-first', 'SaaS', 'automation', title]}
    />
    <style>
      .title {
        font-size: 2em;
        margin: 0.25em 0 0;
      }
      hr {
        border-top: 1px solid #ddd;
        margin: 1rem 0;
      }
    </style>
  </head>

  <body>
    <main class='content-grid'>
      <aside>
        <ProfileCard
          name='Eren Baltacı'
          avatarSrc='/placeholder-social.jpg'
          occupation='Solopreneur'
          location='Turkiye'
          backHref='/blog'
          backLabel='Back to Blog'
        />
      </aside>
      <article>
        {
          heroImageAsset && (
            <Image
              width={720}
              height={360}
              src={heroImageAsset.default}
              alt=''
            />
          )
        }
        <h1 class='title'>{title}</h1>
        {
          publishDate && (
            <time>{new Date(publishDate).toLocaleDateString()}</time>
          )
        }
        {
          updatedDate && (
            <div>
              Last updated on{' '}
              <time>{new Date(updatedDate).toLocaleDateString()}</time>
            </div>
          )
        }
        <hr />
        <slot />
      </article>
    </main>
  </body>
</html>

